<%- include('partials/head') %>
<%- include('partials/sidebar') %>
<%- include('partials/topbar') %>

<div class="content">
  <h1 class="page-title">Categories</h1>

  <!-- Add Category Form - only show if user has create permission -->
  <% if (userRole === 'superadmin' || hasFullAccess || (userPermissions && userPermissions.categories && userPermissions.categories.create)) { %>
  <div class="order-form-wrap mb-6 p-6 rounded shadow-lg">
    <h2 class="mb-4">Add New Category</h2>
    <form action="/category" method="POST" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <input 
        type="text" 
        id="name" 
        name="name" 
        placeholder="Category Name" 
        required 
        class="input-field"
      />
      <input 
        type="file" 
        id="imageFile" 
        name="imageFile" 
        accept="image/*" 
        required 
        class="input-field"
      />

      <!-- <input 
  type="text" 
  name="subcategories" 
  placeholder="Enter subcategories separated by commas (e.g. Tops, Jeans, Jackets)" 
  class="input-field"
/> -->

      <div class="col-span-2">
        <button type="submit" class="btn-submit btn-small">Add Category</button>
      </div>
    </form>
  </div>
  <% } %>

  <!-- Categories Table -->
  <div class="table-wrap">
    <table class="orders-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Category Name</th>
          <th>Image</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% if (categories && categories.length > 0) { %>
          <% categories.forEach((cat, i) => { %>
            <tr>
              <td><%= i + 1 %></td>
              <td><%= cat.name %></td>
              <td>
                <% if (cat.imageUrl) { %>
                  <img 
                    src="<%= cat.imageUrl %>" 
                    alt="<%= cat.name %>" 
                    style="width:50px; height:45px; object-fit:cover; border-radius:6px; border:1px solid #ddd;" 
                  />
                <% } else { %>
                  <span style="color:#999;">No Image</span>
                <% } %>
              </td>

<!-- 
              <td>
  <% if (typeof filterConfig !== "undefined" 
         && filterConfig[cat.name.toLowerCase()] 
         && filterConfig[cat.name.toLowerCase()]["According to Categories"]) { %>
    <%= filterConfig[cat.name.toLowerCase()]["According to Categories"].join(", ") %>
  <% } else { %>
    <span style="color:#999;">No Subcategories</span>
  <% } %>
</td> -->


              <td>
                <!-- Delete button - only show if user has delete permission -->
                <% if (userRole === 'superadmin' || hasFullAccess || (userPermissions && userPermissions.categories && userPermissions.categories.delete)) { %>
                  <a 
                    href="/category/delete/<%= cat._id %>" 
                    class="btn-delete"
                    onclick="return confirm('Are you sure you want to delete this category?')"
                  >
                    Delete
                  </a>
                <% } %>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="4" style="text-align:center; color:#777;">No categories found</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<script src="/js/dashboard.js" defer></script>
<%- include('partials/footer') %>
